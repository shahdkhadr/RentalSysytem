# SQL vs. NoSQL

# SQL

## ACID Properties

### Atomicity

- **Definition:** Ensure that transaction is treated as a single, indivisible ( غير قابلة للتجزئة ) unit
    - This means that either all operations in the transaction are executed, or none at all. If any part of the transaction fails, the entire transaction is rolled back.

### **Scenario:**

- Consider a banking application where Alice wants to transfer $100 to Bob. The transaction involves two operations:
    - Deducting $100 from Alice's account.
    - Adding $100 to Bob's account.
    
    If the deduction from Alice's account succeeds but the addition to Bob's account fails (e.g., due to a system crash), the transaction would leave Alice's account without the intended $100, while Bob's account remains unchanged. Atomicity ensures that both operations either complete successfully or neither does, keeping the system consistent.
    

### Consistency

### **Definition**

Consistency ensures that a transaction brings the database from one valid state to another valid state. **All integrity constraints and rules defined on the database must be adhered to before and after the transaction.**

### **Scenario**

Imagine a scenario in a school database where a student's grade is recorded. If a student's grade must always be within a specific range (e.g., 0 to 100), a transaction to update a grade must maintain this consistency. If an operation attempts to set a grade to 110, it violates the consistency rule, and the transaction should fail, preventing any invalid data from being written to the database.

### Isolation

### **Definition**

- Isolation ensures that concurrent transactions do not interfere with each other. Each transaction must operate independently of others,
- meaning that the intermediate state of a transaction is not visible to other transactions until it is committed.

### **Scenario**

- Consider two transactions happening at the same time:
    - Transaction A is updating the inventory for Product X by reducing the available stock.
    - Transaction B is checking the stock of Product X to determine if an order can be fulfilled.
- If Transaction A has not yet committed its changes, Transaction B should not see the updated inventory until A is complete. Isolation prevents Transaction B from making a decision based on outdated or uncommitted data, thus avoiding inconsistencies in the system.
    - If A make transaction before B Then, B couldn’t make a decision based on outdated or uncommitted data
        - ( او عملية مش صالحة Commit  يوخذ قرار او يعمل عملية بتعتمد على B بيمنع  )
    
    يعني او انا وكمان شخص ثاني بدنا نشتري نفس المنتج من نفس المحل, انا ضغطت على شراء قبل الشخص الاخر بلحظات قليلة , الشخص الاخر ما بتتحدث عنده الانفينتوري او الستوك, الا لما تكتمل العملية عندي, ولما تكتمل العملية عندي بيظهر عنده انو العملية فشلت لانو في حدا ثاني اشتراه
    

### Durability

### **Definition**

- Durability ensures that once a transaction has been committed, its effects are permanent and survive any subsequent system failures.
- This means that the database maintains the changes even in the event of a crash or power loss.

### **Scenario**

In an e-commerce application, when a customer successfully places an order, the transaction is committed. Regardless of what happens next (like a server crash), the order details must be preserved. Durability guarantees that the order is saved in the database, and the customer does not lose their transaction due to unforeseen circumstances.

### Comaprsion between Atomicity & Durability

### Atomicity

- **Definition**: Atomicity refers to the "**all-or-nothing**" principle of transactions.

> It ensures that all operations within a transaction are completed successfully;
> 
- if any operation fails, the entire transaction is aborted, and the database is returned to its previous state. Thus, atomicity guarantees that partial updates do not occur.
- **Focus**: Atomicity is concerned with the **completion** of a transaction. It means that if a transaction involves multiple operations (like transferring funds from one account to another), either all of them are executed, or none of them are.
- **Example**: In a banking scenario, if Alice transfers $100 to Bob, atomicity ensures that:
    - **Step 1**: $100 is deducted from Alice’s account.
    - **Step 2**: $100 is added to Bob’s account.
    
    If the deduction succeeds but the addition fails, the system will roll back the deduction, ensuring that no money is lost.
    

### Durability

- **Definition**: Durability guarantees that once a transaction has been committed, its effects are permanent, even in the event of a system crash, power failure, or other catastrophic events. This means that all changes made by the transaction are saved to persistent storage.
- **Focus**: Durability is concerned with the **persistence** of data after a transaction has completed. It ensures that once a transaction is successfully completed, the changes made will survive any subsequent failures.
- **Example**: Continuing with the banking scenario, once Alice’s transfer to Bob is completed, durability ensures that:
    - The changes (i.e., Alice's account balance decreasing and Bob's account balance increasing) are stored in a durable manner (such as in a hard disk or SSD).
    
    If the server crashes right after the transaction is committed, the data reflecting the new balances will still be available when the system recovers.
    

![image.png](SQL%20vs%20NoSQL%20130f1472fabd80699a2be27954a9c83f/image.png)

### Summary

- ACID work togather to ensure the **integrity** & **reliability** of database transactions
    - **Atomicity** prevents partial transactions from occurring.
        - لو كان عندي مثلا عملية تحويل من حساب لحساب ثاني, ببتكون من عمليتين رئيسيات الاولى انو اسحب مصاري من الحساب الاول , والعملية الثانية انو اضيفهم للحساب الثاني, اذا تمت عملية السحب بنجاح ولكن لما جينا نضيف المصاري ع الحساب الثاني صار مشكلة , **بتنلغى كل العملية**
    - **Consistency** maintains the integrity of the database before and after transactions.
        - لو مثلا كان عندنا علامات طلاب الرينج تبعها من 0 ل 100, المفروض لو عملت أي عملية ع الداتا ما يطلعلي بالجدول داتا جديدة قيمتها أكبر من 100 او اقل من صفر
        - أو مثال ثاني لو كان عنا حساب بنك وسحبنا منه مصاري وصار الرصيد بالسالب مثلاً , وهو أقل رصيد مسموح 0
    - **Isolation** allows concurrent transactions to operate without interference.
        - يعني لو انا وكمان شخص ثاني بدنا نشتري نفس المنتج من نفس المحل, انا ضغطت على شراء قبل الشخص الاخر بلحظات قليلة , الشخص الاخر ما بتتحدث عنده الانفينتوري او الستوك, الا لما تكتمل العملية عندي, ولما تكتمل العملية عندي بيظهر عنده انو العملية فشلت لانو في حدا ثاني اشتراه
    - **Durability** guarantees that committed transactions remain in effect even after failures.
        - لو اليوزر عمل عملية معينة وانعمل كوميت الها , وبعدها صار مشكلة بالسيرفر او صار خلل معيّن مش لازم يخسر العملية اللي عملها او تروح
            - يعني لو اليوزر طلب اوردر معين وانعملله كوميت وبعدها صار خلل بالسيرفر او مشكلة , لازم بس يرجع يشتغل السيرفر او يروح الخلل, يكون الاوردر تبع الزبون لسا مثبت

### Real-World Impact of ACID Properties

- Imagine a real world banking system
    - Without **Atomicity**, a money transfer might result in losing money if one part of the transaction fails.
    - Without **Consistency**, it might be possible to enter invalid transactions (like negative balances).
    - Without **Isolation**, simultaneous transactions might lead to incorrect balances or account states.
    - Without **Durability**, a bank could lose transaction records, leading to financial discrepancies and loss of customer trust.

# NoSQL

## NoSQL Characteristics

- NoSQL صار تحت مظلّة ال RDBMS أي اشي لا تنطبق عليه خصائص ال
- تستخدم بالعادة في التطبيقات اللي فيها معالجة داتا صخمة
- Schema free —> معيّن Structure ما بتقيّدك ب
- easy replication more than SQL

### Eventual Consistency

- is a consistency model used in distributed systems where, given enough time without new updates, all replicas of the data will converge to the same value.
    - الداتا بتوخذلها شوية تا يظهر اخر تحديث منها عند اليوزر, مثل بوستات الفيسبوك
    - بكون عندهم نفس النسخة بالداتا Replicaلكن بنهاية الامر كل ال
- This model is often used in NoSQL databases to enhance availability and performance, allowing for quick writes and reads even in the presence of network partitions.

### Real Scenario Example: Social Media Post

### Scenario Overview

Imagine a social media platform where users can create, like, and comment on posts. This application uses a distributed database with an eventual consistency model to handle high user traffic and allow for quick updates.

### How Eventual Consistency Works in This Scenario

1. **User A Creates a Post**:
    - User A writes a new post, "Just got back from vacation!".
    - This post is sent to the distributed database, where it is stored on multiple servers (replicas).
2. **Immediate Visibility**:
    - User A’s friend, User B, quickly opens their feed. They might not see User A's post immediately due to replication delays between the servers.
    - However, User A sees their post instantly because it was just created.
3. **Likes and Comments**:
    - Shortly after creating the post, User B likes it. This update is sent to the database and is also replicated across multiple nodes.
    - Depending on the system's latency, User A might not see the like right away, especially if they refresh their feed. However, User B can see their like reflected on their view of the post immediately.
4. **Replication Delay**:
    - As the like update is propagated across the distributed system, it takes time for all replicas to synchronize.
    - If User A refreshes their feed immediately after User B likes the post, they may still see the old state of the post (without the like) on some replicas of the database.
5. **Eventual Consistency Achieved**:
    - Over time, as the system continues to process updates and synchronize data between replicas, all users will eventually see the same state of the post (with the like included).
    - If no new updates occur to the post (no new likes or comments), all replicas will converge to the same version after a certain period, ensuring that User A, User B, and any other users see the same data.

### Benefits and Trade-offs

- **Benefits**:
    - **High Availability**: Users can read and write data without being blocked by synchronization issues, ensuring a responsive experience.
    - **Performance**: Writes can be performed quickly, as the system doesn't need to lock resources or wait for all replicas to acknowledge an update.
- **Trade-offs**:
    - **Temporary Inconsistency**: During periods of high traffic or network partitions, users may see outdated or conflicting data, which can lead to confusion (e.g., User A not seeing their post’s likes).
    - **Application Logic Complexity**: Developers may need to implement additional logic in the application to handle scenarios where users might see stale data (e.g., showing timestamps, notifying users of updates).
- BASE ( Not ACID )

## NoSQL with BigData

- Challenges
    - Efficiently storing & accessing large amount of data is difficult ( considering fault tolerance & backups )
    - Manipulating large data sets involves running immensely parallel process
    - Managing semi-structured & un-structured data is difficult

## Why are RDBMS not suitable for BigData?

## RDBMS assumes that data are

- Dense —> null كل الفيلد اللي بالجدول لازم يكون فيها داتا , ممنوع يكون ولا فيلد
- Structured Data only

## Data coming from internet are

- Sparse —> null مسموح يكون في فيلد قيمتها
- massive
    - حجم الداتا بكون ضخم جداً ممكن يوصل حجمه يكون بالتيرا بايت
    - وحجم الداتا بزيد بشكل غير مُتوقّع
    - ونفس الموضوع بالنسبة لنوع الداتا, بيتغيّر بشكل مستمرّ
- Semi-Structured, un-Structured and structured

## NoSQL Database Types

- Document Database
    - MongoDB
    - CouchDB
- Key/Value Stores
    - CouchBase
    - Redis
    - Amazon Dynamo
    - Apache Cassandra
    - Voldemort
    - Riak
- Sorted Ordered Column-Oriented Stores → Data Stores in Column-Oriented way
    - Google Bigtable
    - HBase
- Graph Database → Graph Oriented

# BASE Transactions → Opposite of ACID

- Basically Available
    - يعني لو  نشرت بوست ع الفيسبوك والناس بلشت تعلق عليه , وتتفاعل معه 
    انت لما تيجي تشيّك بيظهرلك البوست تبعك مع شوية تعليقات وممكن يكون في داتا بسا مش محمّلة
        - Basically Available هاذ البوست اللي فيه داتا ناقصة شوي يعتبر
    - Failed
    - Updated Data Not Appear Direclty
- Soft state —> Transient state هاي اللي بتصير قبل ما نوصل لحالة الكونسيستنت
    - The state of the system may change over time, even without new input, and data may exist in a transient state.
    - When a user likes a post, that action may be registered on their local server but not yet reflected on the original post's server. Meanwhile, friends may still see the post without the latest like count or any new comments.
- Eventually Consistent —>Consistencyبالنهاية قد ما تأخر, رح يرجع لحالة ال
    - Consistentممكن السيستيم يتأخر لحتى يوصل لحالة ال

![image.png](SQL%20vs%20NoSQL%20130f1472fabd80699a2be27954a9c83f/image%201.png)

# BASE Characteristics

- Weak Consistency
- Availability first —> بتهتم تعطيك جواب أسرع من انها تعطيك جواب أدق
- Approximate answers OK
- Simpler & Faster
- Affressive ( Optimistic )

# Dealing with BigData and Scalability

- RDBMS —> Were not designed to be distributed
    - Traditional DBMSs are best designed to run well on a **Single Machine**
    - RDBMS —> Use Scaling Up ( Vertical Scaling )
- NoSQL —> Designed to run on clusters or multi-node database solutions
    - NoSQL —> Use Scaling Out ( Horizontal Scaling  )

# Scaling RDBMS

## Master-Slave ( Replication )

- Write operations perform on Master
- Read Operation perform on Slaves
- هاذ الاشي منيح لما يكون في عندنا عدد ريكويستات كبيرة
- لكن ما بيحلّ المشكلة لما يكون في عندنا كمية كبيرة من الداتا

## Sharding

- بنقسّم الداتابيس الكبيرة لأجزاء وكل جزء نحطه ع نود
- مفيد على الحالتين سواء كان عدد الريكويست كبير أو اذا كانت كمية الداتا كبيرة
- There is 2 Types of Sharding
    - Vertical Sharding
    - Horizontal Sharding
- عشان نوجه الريكويست للمكان الصحيح للداتا Sharding Management بنتحتاج
- مشاكله
    - لما بدك تعمل انسيرت , بدك تعمل انسيرت عأكثر من جدول
    - Sharding Management المساحة اللي بيوخذها ال

# CAP Theorem ( Consistency - Availability - Partition Tolerance )

- بتحاول توصف أو تلخّص الخصائص تبعت الداتابيسيس بشكل عام
- CAP Theorem أي داتابيس رح نستخدمها رح ينطبق عليها بس 2 من ال
- Consistency —> Each Client has the same view of data
- Availability —> Each Client can always read and write
- Partition Tolerance —> System works well across distributed physical networks